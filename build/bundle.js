var J=Object.create;var L=Object.defineProperty;var H=Object.getOwnPropertyDescriptor;var K=Object.getOwnPropertyNames,I=Object.getOwnPropertySymbols,Q=Object.getPrototypeOf,$=Object.prototype.hasOwnProperty,V=Object.prototype.propertyIsEnumerable;var T=(t,r,e)=>r in t?L(t,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[r]=e,u=(t,r)=>{for(var e in r||(r={}))$.call(r,e)&&T(t,e,r[e]);if(I)for(var e of I(r))V.call(r,e)&&T(t,e,r[e]);return t};var X=(t,r,e,o)=>{if(r&&typeof r=="object"||typeof r=="function")for(let s of K(r))!$.call(t,s)&&s!==e&&L(t,s,{get:()=>r[s],enumerable:!(o=H(r,s))||o.enumerable});return t};var x=(t,r,e)=>(e=t!=null?J(Q(t)):{},X(r||!t||!t.__esModule?L(e,"default",{value:t,enumerable:!0}):e,t));var l=(t,r,e)=>new Promise((o,s)=>{var i=m=>{try{q(e.next(m))}catch(v){s(v)}},z=m=>{try{q(e.throw(m))}catch(v){s(v)}},q=m=>m.done?o(m.value):Promise.resolve(m.value).then(i,z);q((e=e.apply(t,r)).next())});var E=x(require("../node_modules/express/index.js")),C=x(require("../node_modules/dotenv/lib/main.js"));var k={swagger:"2.0",info:{version:"1.0.0",title:"Swagger SoftTeco frontend task",license:{name:"MIT"}},host:"localhost:3000",basePath:"/",schemes:["http"],consumes:["application/json"],produces:["application/json"],paths:{"/user/login":{post:{summary:"Login user",operationId:"loginUser",tags:["user"],parameters:[{name:"login",in:"body",description:"Data to login user to the app",required:!0,schema:{$ref:"#/definitions/LoginUserRequest"}}],responses:{"200":{description:"Response",schema:{$ref:"#/definitions/UserLogin"}},default:{description:"Error",schema:{$ref:"#/definitions/Error"}}}}},"/user/register":{post:{summary:"Register user",operationId:"registerUser",tags:["user"],parameters:[{name:"register",in:"body",description:"Register user in app",required:!0,schema:{$ref:"#/definitions/RegisterUserRequest"}}],responses:{"200":{description:"Response",schema:{$ref:"#/definitions/UserRegister"}},default:{description:"Error",schema:{$ref:"#/definitions/Error"}}}}},"/statistic/{periodId}":{get:{summary:"Get statistic by period id",operationId:"getStatistic",tags:["statistic"],parameters:[{name:"periodId",in:"path",required:!0,description:"The id of the period to retrieve statistic",type:"string"}],responses:{"200":{description:"Expected response to a valid request",schema:{$ref:"#/definitions/Statistic"}},default:{description:"unexpected error",schema:{$ref:"#/definitions/Error"}}}}}},definitions:{LoginUserRequest:{type:"object",required:["email","password"],properties:{email:{type:"string",example:"admin2@softteco.com"},password:{type:"string",example:"12345"}}},RegisterUserRequest:{type:"object",required:["email","password","firstName","lastName"],properties:{success:{type:"boolean",example:!0},data:{type:"object",properties:{email:{type:"string",example:"admin2@softteco.com"},password:{type:"string",example:"12345"},firstName:{type:"string",example:"Ivan"},lastName:{type:"string",example:"Ivanov"}}}}},UserLogin:{required:["email","password"],properties:{success:{type:"boolean",example:!0},data:{type:"object",properties:{email:{type:"string"},password:{type:"string"},firstName:{type:"string"},lastName:{type:"string"}}}}},UserRegister:{required:["email","password","firstName","lastName"],properties:{success:{type:"boolean",example:!0},data:{type:"object",properties:{email:{type:"string"},password:{type:"string"},firstName:{type:"string"},lastName:{type:"string"}}}}},Statistic:{required:["periodId"],properties:{success:{type:"boolean",example:!0},data:{type:"object",properties:{period:{type:"string",example:"Last hour"},errors:{type:"string",example:"7%"},zeroes:{type:"string",example:"6.25%"},timeouts:{type:"string",example:"9.5%"},average:{type:"string",example:"8%"},error500:{type:"number",example:1768},error501:{type:"number",example:705},error502:{type:"number",example:331},otherErrors:{type:"number",example:139},searches:{type:"number",example:26716},searchesLastPeriod:{type:"number",example:24842},mobileTraffic:{type:"string",example:"6.75%"},webTraffic:{type:"string",example:"2%"},clicks:{type:"number",example:711},clicksLastPeriod:{type:"number",example:211},bookings:{type:"number",example:151},bookingsLastPeriod:{type:"number",example:179},bookingsSTR:{type:"string",example:"9.5%"},bookingsAvgCheck:{type:"number",example:207}}}}},Error:{required:["code","message"],properties:{success:{type:"boolean",example:!1},message:{type:"string",example:"USER_NOT_FOUND"},errors:{type:"array",example:[{email:"invalid"}]}}}}};function p(t,r,e=200,o="ERROR",s=[]){let i={success:!1,message:o,errors:s};return r.status(e).json(i)}function g(t,r,e={},o=200){let s={success:!0,data:e};return r.status(o).json(s)}function a(t,r){return+(t+Math.random()*(r-t)).toFixed(0)}function c(t){return Math.floor(Math.random()*(10*t-t)+t)/t}function h(){return{errors:`${c(4)}%`,zeroes:`${c(4)}%`,timeouts:`${c(4)}%`,average:`${c(4)}%`,error500:a(1e3,2e3),error501:a(100,999),error502:a(100,999),otherErrors:a(100,999),searches:a(1e4,3e4),searchesLastPeriod:a(1e4,3e4),mobileTraffic:`${c(4)}%`,webTraffic:`${c(4)}%`,clicks:a(10,1e3),clicksLastPeriod:a(10,1e3),bookings:a(10,1e3),bookingsLastPeriod:a(10,1e3),bookingsSTR:`${c(4)}%`,bookingsAvgCheck:a(10,1e3)}}var D=function(t){switch(t){case 0:return u({period:"Last hour"},h());case 1:return u({period:"Today"},h());case 2:return u({period:"Yesterday"},h());case 3:return u({period:"Last 3 days"},h());default:throw new Error("Wrong periodId!")}};var w=class{static routeGetStatistic(){return function(e,o){return l(this,null,function*(){let{periodId:s}=e.params;try{let i=u({},D(+s));return g(e,o,i)}catch(i){return p(e,o,400,"WRONG_PERIOD_ID",[{periodId:"Unknown period id"}])}})}}};var P=x(require("../node_modules/express-rate-limit/dist/index.cjs")),f=(0,P.default)({windowMs:10*60*1e3,max:5});var ee=require("../node_modules/express/index.js"),j=ee.Router({mergeParams:!0});j.get("/:periodId",f,w.routeGetStatistic());var O=j;var G=x(require("../node_modules/express/index.js"));var y=require("../node_modules/express-validator/src/index.js");var _=require("../node_modules/node-json-db/dist/JsonDB.js"),M=require("../node_modules/node-json-db/dist/lib/JsonDBConfig.js"),F=new _.JsonDB(new M.Config("database",!0,!1,"/"));function U(t){return F.getData(`/${t}`)}function A(t,r){return F.push(`/${t}`,r)}var B=require("../node_modules/express-validator/src/index.js"),d=class{};d.validationResult=r=>B.validationResult.withDefaults({formatter:e=>({[e.param]:e.msg})})(r);var R=class{static routeUserRegistration(){return function(e,o,s){return l(this,null,function*(){yield(0,y.body)("email").isEmail().run(e),yield(0,y.body)("password").not().isEmpty().withMessage("required").isLength({min:5}).run(e),yield(0,y.body)("firstName").isString().run(e),yield(0,y.body)("lastName").isString().run(e);let i=d.validationResult(e);return i.isEmpty()?s():o.status(400).json({errors:i.array()})})}}static registerUser(r,e){let{email:o}=r.body;try{let s;try{s=U(o)}catch(i){}return s?p(r,e,400,"USER_ALREADY_REGISTERED",[{user:"User with current email already exist"}]):(A(o,r.body),g(r,e,r.body))}catch(s){return p(r,e,400,"SERVER_ERROR")}}};var N=require("../node_modules/express-validator/src/index.js");var b=class{static routeUserLogin(){return function(e,o,s){return l(this,null,function*(){yield(0,N.body)("email").isEmail().run(e),yield(0,N.body)("password").not().isEmpty().withMessage("required").isLength({min:5}).run(e);let i=d.validationResult(e);return i.isEmpty()?s():p(e,o,400,"ERROR_PARAMS",i.array())})}}static getUser(r,e){let{email:o}=r.body;try{let s=U(o);return g(r,e,s)}catch(s){return p(r,e,400,"USER_NOT_FOUND")}}};var S=G.default.Router({mergeParams:!0});S.post("/register",f,R.routeUserRegistration(),R.registerUser);S.post("/login",f,b.routeUserLogin(),b.getUser);var W=S;var Y=require("../node_modules/swagger-ui-express/index.js"),re=require("../node_modules/cors/lib/index.js"),n=(0,E.default)();C.default.config();n.use(re({credentials:!1}));n.use(E.default.json({limit:"2mb"}));n.use(E.default.urlencoded({extended:!0}));n.use("/docs",Y.serve);n.get("/docs",Y.setup(k));n.get("/",(t,r)=>{r.send("Wow! You are doing SoftTeco frontend task. We believe that you will succeed!! :)")});n.use("/user",W);n.use("/statistic",O);n.listen(process.env.PORT||3e3,()=>{console.info(`Server started at http://localhost:${process.env.PORT||3e3}`)});
